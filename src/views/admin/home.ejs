<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - BlueBook Admin</title>

    <link rel="stylesheet" href="/admin/css/home.css" />
    <link rel="stylesheet" href="/admin/css/dashboard.css" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <span class="logo-text">BlueBook</span>
      </div>

      <div class="logo-divider"></div>

      <nav class="menu">
        <a href="/admin/home" class="menu-item active">
          <i class="fa-solid fa-chart-line"></i> Dashboard
        </a>

        <div class="menu-group">
          <button class="menu-item dropdown-btn">
            <div class="menu-left">
              <i class="fa-solid fa-book"></i>
              <span>Sách</span>
            </div>
            <i class="fa-solid fa-chevron-down arrow"></i>
          </button>

          <div class="dropdown">
            <a href="/admin/quanlysach" class="menu-sub">
              <i class="fa-solid fa-list"></i> Danh sách sách
            </a>
            <a href="/admin/theloai" class="menu-sub">
              <i class="fa-solid fa-shapes"></i> Thể loại
            </a>
            <a href="/admin/thongke-tonkho" class="menu-sub">
              <i class="fa-solid fa-chart-column"></i> Thống kê tồn kho
            </a>
          </div>
        </div>

        <a href="/quanlykhachhang" class="menu-item">
          <i class="fa-solid fa-users"></i> Khách hàng
        </a>

        <a href="/admin/quanlydonhang" class="menu-item">
          <i class="fa-solid fa-file-invoice"></i> Đơn hàng
        </a>

        <a href="/admin/doanhthu?preset=today" class="menu-item">
          <i class="fa-solid fa-coins"></i> Doanh thu
        </a>

        <a href="/logout" class="menu-item logout">
          <i class="fa-solid fa-right-from-bracket"></i> Đăng xuất
        </a>
      </nav>
    </aside>

    <!-- TOPBAR -->
    <header class="topbar">
      <div class="top-right">
        <div class="user-box">
          <i class="fa-solid fa-user"></i>
          <span class="user-name">Admin</span>
          <span class="role">Quản trị viên</span>
        </div>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <div class="main">
      <main class="dashboard-page">
        <!-- HEADER -->
        <div class="dashboard-header">
          <h1 class="dashboard-title">Tổng quan hệ thống</h1>
          <p class="dashboard-subtitle">
            Theo dõi nhanh doanh thu, đơn hàng, sách và người dùng của BlueBook.
          </p>
        </div>

        <!-- KPI CARDS -->
        <section class="dashboard-stats">
          <div class="stat-card">
            <div class="stat-icon icon-green">
              <i class="fa-solid fa-sack-dollar"></i>
            </div>
            <div class="stat-content">
              <div class="stat-label">Tổng doanh thu</div>
              <div class="stat-value">
                <%=Number(tongdoanhthu.tongtien).toLocaleString("vi-VN")%>đ
              </div>
              <div class="stat-note">Tính đến hôm nay</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon icon-blue">
              <i class="fa-solid fa-receipt"></i>
            </div>
            <div class="stat-content">
              <div class="stat-label">Tổng số đơn</div>
              <div class="stat-value"><%=tongsodon.tongdon%></div>
              <div class="stat-note">Toàn bộ hệ thống</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon icon-orange">
              <i class="fa-solid fa-book"></i>
            </div>
            <div class="stat-content">
              <div class="stat-label">Sách đang bán</div>
              <div class="stat-value"><%=tongsach.tongsach%></div>
              <div class="stat-note">Đang hiển thị</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon icon-purple">
              <i class="fa-solid fa-user-group"></i>
            </div>
            <div class="stat-content">
              <div class="stat-label">Người dùng</div>
              <div class="stat-value"><%=tongnguoidung.tonguser%></div>
              <div class="stat-note">Tài khoản đăng ký</div>
            </div>
          </div>
        </section>

        <!-- ROW 2: ĐƠN HÀNG + SÁCH BÁN CHẠY -->
        <section class="tables-grid">
          <!-- ĐƠN HÀNG MỚI -->
          <div class="table-card header-orders">
            <div class="table-card-header">
              <div class="table-card-title">
                <i class="fa-solid fa-bag-shopping"></i>
                <div>
                  <h2>Đơn hàng mới nhất</h2>
                  <p>Những đơn hàng gần đây trong hệ thống</p>
                </div>
              </div>
              <a href="/admin/quanlydonhang"
                ><span class="badge-pill">Xem tất cả</span></a
              >
            </div>

            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Mã đơn</th>
                    <th>Khách hàng</th>
                    <th class="text-right">Tổng tiền</th>
                    <th>Trạng thái</th>
                    <th>Ngày mua</th>
                  </tr>
                </thead>
                <tbody>
                  <%for (let i = 0 ; i < top5donhangmoi.length;i++){ %>
                  <tr>
                    <td><%=top5donhangmoi[i].madonhang%></td>
                    <td><%=top5donhangmoi[i].taikhoan%></td>
                    <td class="text-right">
                      <%=Number(top5donhangmoi[i].tongtien).toLocaleString("vi-VN")%>đ
                    </td>
                    <td>
                      <span class="status-badge status-completed">
                        <%=top5donhangmoi[i].trangthai%>
                      </span>
                    </td>
                    <td>
                      <%=top5donhangmoi[i].ngaymua.toLocaleDateString("vi-VN")%>
                    </td>
                  </tr>
                  <% }%>
                </tbody>
              </table>
            </div>
          </div>

          <!-- SÁCH BÁN CHẠY -->
          <div class="table-card header-books">
            <div class="table-card-header">
              <div class="table-card-title">
                <i class="fa-solid fa-fire"></i>
                <div>
                  <h2>Sách bán chạy</h2>
                  <p>Top sách có doanh thu cao</p>
                </div>
              </div>
              <span class="badge-pill">Top 6</span>
            </div>

            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Tên sách</th>
                    <th>Thể loại</th>
                    <th class="text-right">SL bán</th>
                    <th class="text-right">Doanh thu</th>
                  </tr>
                </thead>

                <tbody>
                  <% if (top6sachbanchay.length > 0) { %> <% for (let i = 0; i <
                  top6sachbanchay.length; i++) { %>
                  <tr>
                    <td><%= top6sachbanchay[i].tensach %></td>
                    <td><%= top6sachbanchay[i].tentheloai %></td>
                    <td class="text-right"><%= top6sachbanchay[i].sl %></td>
                    <td class="text-right">
                      <%= top6sachbanchay[i].doanhthu.toLocaleString('vi-VN')
                      %>đ
                    </td>
                  </tr>
                  <% } %> <% } else { %>
                  <tr>
                    <td colspan="4" class="empty-row">
                      Không có dữ liệu sách bán chạy
                    </td>
                  </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ROW 3: TỒN KHO THẤP + USER MỚI -->
        <section class="tables-grid">
          <!-- SÁCH TỒN KHO THẤP -->
          <div class="table-card header-stock">
            <div class="table-card-header">
              <div class="table-card-title">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <div>
                  <h2>Sách tồn kho thấp</h2>
                  <p>Cần nhập thêm để tránh hết hàng</p>
                </div>
              </div>
              <span class="badge-pill">Cảnh báo</span>
            </div>

            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Tên sách</th>
                    <th class="text-right">Tồn kho</th>
                  </tr>
                </thead>
                <tbody>
                  <%for (let i = 0; i < tonkho.length; i++){ %>
                  <tr>
                    <td><%=tonkho[i].tensach%></td>
                    <td class="text-right"><%=tonkho[i].sl_tonkho%></td>
                  </tr>
                  <% }%>
                </tbody>
              </table>
            </div>
          </div>

          <!-- NGƯỜI DÙNG MỚI -->
          <div class="table-card header-users">
            <div class="table-card-header">
              <div class="table-card-title">
                <i class="fa-solid fa-user-plus"></i>
                <div>
                  <h2>Người dùng mới</h2>
                  <p>Các tài khoản mới đăng ký gần đây</p>
                </div>
              </div>
              <span class="badge-pill">7 ngày gần đây</span>
            </div>

            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Họ tên</th>
                    <th>Email</th>
                  </tr>
                </thead>

                <tbody>
                  <% if (top5nguoidungmoi.length > 0) { %> <% for (let i = 0; i
                  < top5nguoidungmoi.length; i++) { %>
                  <tr>
                    <td><%= top5nguoidungmoi[i].hoten %></td>
                    <td><%= top5nguoidungmoi[i].email %></td>
                  </tr>
                  <% } %> <% } else { %>
                  <tr>
                    <td colspan="2" class="empty-row">
                      Không có người dùng mới
                    </td>
                  </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script>
      // Dropdown menu sách ở sidebar
      const btn = document.querySelector(".dropdown-btn");
      const drop = document.querySelector(".dropdown");
      const arrow = document.querySelector(".arrow");

      if (btn) {
        btn.addEventListener("click", () => {
          drop.classList.toggle("show");
          arrow.classList.toggle("rotate");
        });
      }
    </script>
  </body>
</html>
